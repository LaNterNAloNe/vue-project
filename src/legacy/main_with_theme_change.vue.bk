<template>
    <!-- é¡µé¢å†…å®¹ -->
    <div class="page-container">
      <!-- ä¸»æ ‡é¢˜ã€ä¸Šä¼ å¡ç‰‡ã€å­—å¹•å¡ç‰‡ç­‰ -->
        <!-- é¡µé¢ä¸»æ ‡é¢˜ -->
    <h1 class="main-title">ğŸ¬ è§†é¢‘å­—å¹•å¤„ç†å¹³å°</h1>
    <el-divider content-position="left">ä¸Šä¼ ä¸è§£æ</el-divider>

    <!-- è§†é¢‘ä¸Šä¼ å¡ç‰‡ -->
    <el-card class="upload-card" shadow="hover">
      <div class="header">
        <el-icon><VideoCamera /></el-icon>
        <span class="title">è§†é¢‘ä¸Šä¼ </span>
        <!-- [è§†é¢‘ä¸Šä¼ ]è¯´æ˜æ–‡å­— -->
        </div>
        <p class="description">è¯·ä¸Šä¼  MP4 æˆ–å…¶ä»–å¸¸è§æ ¼å¼çš„è§†é¢‘æ–‡ä»¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§£æå­—å¹•ã€‚</p>
        <div class="upload-instructions">

      </div>

      <el-upload
        class="upload-area"
        drag
        action="/api/upload"
        accept="video/*"
        :before-upload="beforeUpload"
        :headers="uploadHeaders"
        :data="uploadData"
        :on-success="handleUploadSuccess"
        :show-file-list="false"
      >
        <el-icon class="upload-icon"><UploadFilled /></el-icon>
        <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </div>
      </el-upload>
    </el-card>

    <!-- å­—å¹•å±•ç¤ºå¡ç‰‡ -->
    <el-card v-if="subtitles.length" class="table-card" shadow="hover">
      <div class="table-title">ğŸ“ å­—å¹•ç¿»è¯‘ç»“æœ</div>
      <el-table :data="subtitles" stripe border style="width: 100%">
        <el-table-column prop="start" label="å¼€å§‹æ—¶é—´" width="120" />
        <el-table-column prop="end" label="ç»“æŸæ—¶é—´" width="120" />
        <el-table-column prop="original" label="åŸæ–‡å­—å¹•" />
        <el-table-column prop="translated" label="ç¿»è¯‘å­—å¹•" />
      </el-table>
    </el-card>
    </div>
  </div>
</template>



<script setup>
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import { UploadFilled, VideoCamera } from '@element-plus/icons-vue'

import { useSubtitleStore } from './stores/subtitles'
import { computed } from 'vue'

import { useThemeStore } from './stores/theme'

// ä¸»é¢˜çŠ¶æ€
const themeStore = useThemeStore()

// å­—å¹•æ•°æ®
const subtitleStore = useSubtitleStore()
const subtitles = computed(() => subtitleStore.subtitles)
const language = computed(() => subtitleStore.language)

// ä¸Šä¼ å‰æ ¡éªŒ
const beforeUpload = (file) => {
  const isVideo = file.type.startsWith('video/')
//   const isSizeOk = file.size / 1024 / 1024 < 100 // é™åˆ¶100MB

  if (!isVideo) {
    ElMessage.error('æ–‡ä»¶ç±»å‹é”™è¯¯ï¼šåªèƒ½ä¸Šä¼ è§†é¢‘æ–‡ä»¶')
    return false
  }

//   // æ¨¡æ‹Ÿä¸Šä¼ æˆåŠŸ
//   setTimeout(() => {
//     const mockResponse = {
//       subtitles: [
//             { start: '00:00:01', end: '00:00:03', original: 'Hello', translated: 'ä½ å¥½' },
//             { start: '00:00:04', end: '00:00:06', original: 'World', translated: 'ä¸–ç•Œ' }
//         ]
//     }
//     handleUploadSuccess(mockResponse)
//   }, 1000)

//   if (!isSizeOk) {
//     ElMessage.warning('æ–‡ä»¶è¿‡å¤§ï¼šè¯·ä¸Šä¼ å°äº100MBçš„è§†é¢‘')
//     return false
//   }

  ElMessage.success('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨è§£æå­—å¹•...')
  return true // æ ¡éªŒé€šè¿‡ï¼Œç»§ç»­ä¸Šä¼ 
}

// ä¸Šä¼ æˆåŠŸå›è°ƒ
const handleUploadSuccess = (response) => {
  if (response && response.subtitles) {
    subtitles.value = response.subtitles
    ElMessage.success('å­—å¹•è§£ææˆåŠŸ')
  } else {
    ElMessage.error('å­—å¹•è§£æå¤±è´¥')
  }
}

// è¯·æ±‚å¤´ï¼ˆå¯é€‰ï¼‰
const uploadHeaders = {
  // Authorization: 'Bearer your-token'
}

// é™„åŠ å‚æ•°ï¼ˆå¯é€‰ï¼‰
const uploadData = {
  // userId: 123
}
</script>


<style scoped>
.page-container {
  max-width: 800px;
  margin: 40px auto;
  padding: 0 20px;
}

.upload-card {
  padding: 20px;
  margin-bottom: 50px;
}

.header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.header .title {
  font-size: 20px;
  font-weight: bold;
  margin-left: 10px;
}

.upload-area {
  text-align: center;
  padding: 40px 20px;
  border: 2px dashed #409EFF;
  border-radius: 8px;
  background-color: #f9f9f9;
}

.upload-icon {
  font-size: 40px;
  color: #409EFF;
  margin-bottom: 10px;
}

.upload-text {
  font-size: 16px;
  color: #666;
}

.table-card {
  padding: 20px;
}

.table-title {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 15px;
}

.page-container {
  margin: 40px auto;
  padding: 0 20px;
  max-width: 800px;
  min-width: 360px;
  box-sizing: border-box;
}

/* å¡ç‰‡æ ·å¼ä¿æŒä¸€è‡´ */
.upload-card,
.table-card {
  padding: 20px;
  margin-bottom: 30px;
}

/* å“åº”å¼è°ƒæ•´ï¼šåœ¨å°å±å¹•ä¸‹å±…ä¸­å¹¶ç¨å¾®ç¼©å°å­—ä½“ */
@media screen and (max-width: 480px) {
  .header .title {
    font-size: 18px;
  }

  .upload-text {
    font-size: 14px;
  }

  .upload-icon {
    font-size: 32px;
  }
}

</style>
