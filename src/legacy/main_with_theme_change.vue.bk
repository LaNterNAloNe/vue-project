<template>
    <!-- 页面内容 -->
    <div class="page-container">
      <!-- 主标题、上传卡片、字幕卡片等 -->
        <!-- 页面主标题 -->
    <h1 class="main-title">🎬 视频字幕处理平台</h1>
    <el-divider content-position="left">上传与解析</el-divider>

    <!-- 视频上传卡片 -->
    <el-card class="upload-card" shadow="hover">
      <div class="header">
        <el-icon><VideoCamera /></el-icon>
        <span class="title">视频上传</span>
        <!-- [视频上传]说明文字 -->
        </div>
        <p class="description">请上传 MP4 或其他常见格式的视频文件，系统将自动解析字幕。</p>
        <div class="upload-instructions">

      </div>

      <el-upload
        class="upload-area"
        drag
        action="/api/upload"
        accept="video/*"
        :before-upload="beforeUpload"
        :headers="uploadHeaders"
        :data="uploadData"
        :on-success="handleUploadSuccess"
        :show-file-list="false"
      >
        <el-icon class="upload-icon"><UploadFilled /></el-icon>
        <div class="upload-text">点击或拖拽视频文件到此处上传</div>
      </el-upload>
    </el-card>

    <!-- 字幕展示卡片 -->
    <el-card v-if="subtitles.length" class="table-card" shadow="hover">
      <div class="table-title">📝 字幕翻译结果</div>
      <el-table :data="subtitles" stripe border style="width: 100%">
        <el-table-column prop="start" label="开始时间" width="120" />
        <el-table-column prop="end" label="结束时间" width="120" />
        <el-table-column prop="original" label="原文字幕" />
        <el-table-column prop="translated" label="翻译字幕" />
      </el-table>
    </el-card>
    </div>
  </div>
</template>



<script setup>
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import { UploadFilled, VideoCamera } from '@element-plus/icons-vue'

import { useSubtitleStore } from './stores/subtitles'
import { computed } from 'vue'

import { useThemeStore } from './stores/theme'

// 主题状态
const themeStore = useThemeStore()

// 字幕数据
const subtitleStore = useSubtitleStore()
const subtitles = computed(() => subtitleStore.subtitles)
const language = computed(() => subtitleStore.language)

// 上传前校验
const beforeUpload = (file) => {
  const isVideo = file.type.startsWith('video/')
//   const isSizeOk = file.size / 1024 / 1024 < 100 // 限制100MB

  if (!isVideo) {
    ElMessage.error('文件类型错误：只能上传视频文件')
    return false
  }

//   // 模拟上传成功
//   setTimeout(() => {
//     const mockResponse = {
//       subtitles: [
//             { start: '00:00:01', end: '00:00:03', original: 'Hello', translated: '你好' },
//             { start: '00:00:04', end: '00:00:06', original: 'World', translated: '世界' }
//         ]
//     }
//     handleUploadSuccess(mockResponse)
//   }, 1000)

//   if (!isSizeOk) {
//     ElMessage.warning('文件过大：请上传小于100MB的视频')
//     return false
//   }

  ElMessage.success('文件上传成功，正在解析字幕...')
  return true // 校验通过，继续上传
}

// 上传成功回调
const handleUploadSuccess = (response) => {
  if (response && response.subtitles) {
    subtitles.value = response.subtitles
    ElMessage.success('字幕解析成功')
  } else {
    ElMessage.error('字幕解析失败')
  }
}

// 请求头（可选）
const uploadHeaders = {
  // Authorization: 'Bearer your-token'
}

// 附加参数（可选）
const uploadData = {
  // userId: 123
}
</script>


<style scoped>
.page-container {
  max-width: 800px;
  margin: 40px auto;
  padding: 0 20px;
}

.upload-card {
  padding: 20px;
  margin-bottom: 50px;
}

.header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.header .title {
  font-size: 20px;
  font-weight: bold;
  margin-left: 10px;
}

.upload-area {
  text-align: center;
  padding: 40px 20px;
  border: 2px dashed #409EFF;
  border-radius: 8px;
  background-color: #f9f9f9;
}

.upload-icon {
  font-size: 40px;
  color: #409EFF;
  margin-bottom: 10px;
}

.upload-text {
  font-size: 16px;
  color: #666;
}

.table-card {
  padding: 20px;
}

.table-title {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 15px;
}

.page-container {
  margin: 40px auto;
  padding: 0 20px;
  max-width: 800px;
  min-width: 360px;
  box-sizing: border-box;
}

/* 卡片样式保持一致 */
.upload-card,
.table-card {
  padding: 20px;
  margin-bottom: 30px;
}

/* 响应式调整：在小屏幕下居中并稍微缩小字体 */
@media screen and (max-width: 480px) {
  .header .title {
    font-size: 18px;
  }

  .upload-text {
    font-size: 14px;
  }

  .upload-icon {
    font-size: 32px;
  }
}

</style>
